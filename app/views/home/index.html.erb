<% content_for :title, "Login with LEARN" %>
<% content_for :head do %>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<% end %>

<main class="page-shell">
  <section class="panel hero reveal">
    <p class="hero-badge">Authorization Code + PKCE</p>
    <h1>Login with LEARN</h1>
    <p class="hero-copy">
      Example OAuth client for validating LEARN integration against a local provider, with OIDC profile claims and
      a session-backed UI.
    </p>

    <div class="auth-action">
      <% if @learn_uid.present? %>
        <%= button_to "Logout", logout_path, method: :delete, class: "btn btn-secondary" %>
      <% else %>
        <%= button_to "Login with LEARN", "/auth/learn", method: :post, class: "btn btn-primary" %>
      <% end %>
    </div>
  </section>

  <% if flash[:notice].present? || flash[:alert].present? %>
    <section class="flash-stack reveal delay-1">
      <% if flash[:notice].present? %>
        <p class="flash flash-notice"><%= flash[:notice] %></p>
      <% end %>

      <% if flash[:alert].present? %>
        <p class="flash flash-alert"><%= flash[:alert] %></p>
      <% end %>
    </section>
  <% end %>

  <section class="panel reveal delay-1">
    <h2>Session Snapshot</h2>

    <% if @learn_uid.present? %>
      <div class="kv-grid">
        <article class="kv-card">
          <p class="kv-label">UID</p>
          <p class="kv-value"><%= @learn_uid %></p>
        </article>
        <article class="kv-card">
          <p class="kv-label">Name</p>
          <p class="kv-value"><%= @learn_user["name"] || "n/a" %></p>
        </article>
        <article class="kv-card">
          <p class="kv-label">Email</p>
          <p class="kv-value"><%= @learn_user["email"] || "n/a" %></p>
        </article>
        <article class="kv-card">
          <p class="kv-label">Access Token</p>
          <p class="kv-value"><%= @learn_token.present? ? "present" : "missing" %></p>
        </article>
        <article class="kv-card">
          <p class="kv-label">Enabled accounts</p>
          <p class="kv-value"><%= Array(@learn_user["enabled_accounts"]).join(", ").presence || "n/a" %></p>
        </article>
        <article class="kv-card">
          <p class="kv-label">Level</p>
          <p class="kv-value"><%= @learn_user["level"] || "n/a" %></p>
        </article>
        <article class="kv-card">
          <p class="kv-label">Level Name</p>
          <p class="kv-value"><%= @learn_user["level_name"] || "n/a" %></p>
        </article>
      </div>
    <% else %>
      <p class="body-copy">
        No active session yet. Start the OAuth flow to inspect profile claims and token availability in this client.
      </p>
    <% end %>
  </section>

  <section class="panel reveal delay-2">
    <h2>Provider Redirect</h2>
    <p class="body-copy">Register this callback in the LEARN provider application configuration:</p>
    <p class="mono code-pill">/auth/learn/callback</p>
    <p class="mono code-pill">http://localhost:3000/auth/learn/callback</p>
  </section>
</main>
